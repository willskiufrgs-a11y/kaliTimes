```
layout: default
title: Mapa de Conceitos
permalink: /mapa/
```

<div id="mynetwork" style="width: 100%; height: 600px; border: 1px solid #ccc;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />

<script>
    const baseUrl = 'https://willskiufrgs-a11y.github.io';
    // AQUI: No início do seu script
// PostURLs contém: ["/kalitimes/tccblog/", "/kalitimes/post-2/"]
    // 1. DADOS COLETADOS VIA LIQUID SERÃO INJETADOS AQUI (JSON)
// 1. INJEÇÃO DE DADOS: O Liquid insere o conteúdo HTML de TODOS os posts
    const allPosts = [
    {% for post in site.posts %}
        {
            url: "{{ post.url | relative_url }}",
            // IMPORTANTE: 'content' é o HTML completo do post.
            // O filtro 'escape_once' garante que aspas e caracteres especiais não quebrem o JSON.
            title: "{{ post.title | escape }}",
            content: `{{ post.content | strip_newlines | escape_once }}`
        }
        {% unless forloop.last %},{% endunless %}
    {% endfor %}
    ];
    const postURLs = allPosts.map(p => p.url.toLowerCase()); 
    const nodes = [];
    const edges = [];
   //     {% for post in site.posts %}
    //    {
     //       id: "{{ post.url | relative_url }}",
   //         label: "{{ post.title | escape }}",
 //           url: "{{ post.url | relative_url }}",
 //           color: "#4da3ff" // Cor padrão para os nós
 //       }
//        {% unless forloop.last %},{% endunless %}
//    {% endfor %}
//    ];
allPosts.forEach(post => {
    // Adiciona o nó do post atual
    nodes.push({ id: post.url, label: post.title, url: post.url, color: "#4da3ff" });
    // Cria um container virtual para analisar o HTML (para o JS 'ler' os links)
    const parser = new DOMParser();
    const doc = parser.parseFromString(post.content, 'text/html');
    // Encontra todos os links <a> no conteúdo do post
    const links = doc.querySelectorAll('a');
    // ... dentro do allPosts.forEach (loop de posts) ...
links.forEach(link => {
    let targetUrl = link.getAttribute('href');
    if (targetUrl) {
        // 1. Descodificação de URL (para lidar com caracteres especiais, ex: %C3%A3)
        try {
            targetUrl = decodeURI(targetUrl);
        } catch (e) {
            // Se falhar na descodificação, usa a string original
        }
        // 2. Simplificação e Minúsculas
        targetUrl = targetUrl.toLowerCase();
        // 3. Checagem Heurística (a nova regra)
        // Percorre cada URL de postagem válida para ver se o link contém ela
        postURLs.forEach(postUrlLimp => {
            // postUrlLimp é algo como "/kalitimes/nome-do-post/"
            // targetUrl é algo como "https://willskiufrgs-a11y.github.io/kalitimes/nome-do-post"
            // CRITÉRIO DE CONEXÃO: targetUrl DEVE conter o nome completo do link
            if (targetUrl.includes(postUrlLimp) && postUrlLimp !== post.url) { 
                // Remove a barra final do postUrlLimp para usá-lo como ID de destino
                const toId = postUrlLimp.endsWith('/') ? postUrlLimp.slice(0, -1) : postUrlLimp;
                edges.push({
                    from: post.url,
                    to: postUrlLimp, // Usa a URL limpa do Jekyll como ID de destino
                    arrows: "to",
                    label: link.textContent.trim() 
                });
            }
        });
    }
});
});
    // 2. INICIALIZAÇÃO DO VIS.JS
    const container = document.getElementById('mynetwork');
    const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
    const options = { 
        physics: { enabled: true }, 
        interaction: { navigationButtons: true } 
    };
    const network = new vis.Network(container, data, options);
    // Adiciona evento de click para navegação
    network.on('click', function (properties) {
        if (properties.nodes.length > 0) {
            const nodeId = properties.nodes[0];
            // Lógica para obter a URL do nó clicado e navegar
        }
    });
</script>

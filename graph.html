---
layout: default
title: Mapa de Conceitos
permalink: /mapa/
---

<div id="mynetwork" style="width: 100%; height: 600px; border: 1px solid #ccc;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />

<script>
    // 1. DADOS COLETADOS VIA LIQUID SERÃO INJETADOS AQUI (JSON)

// 1. INJEÇÃO DE DADOS: O Liquid insere o conteúdo HTML de TODOS os posts
    const allPosts = [
    {% for post in site.posts %}
        {
            url: "{{ post.url | relative_url }}",
            // IMPORTANTE: 'content' é o HTML completo do post.
            // O filtro 'escape_once' garante que aspas e caracteres especiais não quebrem o JSON.
            title: "{{ post.title | escape }}",
            content: `{{ post.content | strip_newlines | escape_once }}`
        }
        {% unless forloop.last %},{% endunless %}
    {% endfor %}
    ];

    const nodes = [];
    const edges = [];
   //     {% for post in site.posts %}
    //    {
     //       id: "{{ post.url | relative_url }}",
   //         label: "{{ post.title | escape }}",
 //           url: "{{ post.url | relative_url }}",
 //           color: "#4da3ff" // Cor padrão para os nós
 //       }
//        {% unless forloop.last %},{% endunless %}
//    {% endfor %}
//    ];

    
  const postURLs = allPosts.map(p => p.url); // Lista de URLs para verificar se o link é interno

allPosts.forEach(post => {
    // Adiciona o nó do post atual
    nodes.push({ id: post.url, label: post.title, url: post.url, color: "#4da3ff" });
    
    // Cria um container virtual para analisar o HTML (para o JS 'ler' os links)
    const parser = new DOMParser();
    const doc = parser.parseFromString(post.content, 'text/html');
    
    // Encontra todos os links <a> no conteúdo do post
    const links = doc.querySelectorAll('a');

links.forEach(link => {
            let targetUrl = link.getAttribute('href');
            
            if (targetUrl) {
                
                // 1. Normalização do URL (remove o domínio completo)
                if (targetUrl.startsWith(baseUrl)) {
                    targetUrl = targetUrl.substring(baseUrl.length);
                }

                // 2. Normalização da barra final (CRUCIAL PARA JEKYLL PERMALINKS)
                if (!targetUrl.endsWith('/') && !targetUrl.includes('#') && !targetUrl.includes('?')) {
                    targetUrl += '/';
                }
                
                // 3. Verifica se o link normalizado é um post interno
                if (postURLs.includes(targetUrl) && targetUrl !== post.url) { 
                    edges.push({
                        from: post.url,
                        to: targetUrl,
                        arrows: "to",
                        // Adiciona o texto do link como a label da aresta
                        label: link.textContent.trim() 
                    });
                }
            }
        });
});
    

    // 2. INICIALIZAÇÃO DO VIS.JS
    const container = document.getElementById('mynetwork');
    const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
    const options = { 
        physics: { enabled: true }, 
        interaction: { navigationButtons: true } 
    };
    const network = new vis.Network(container, data, options);
    
    // Adiciona evento de click para navegação
    network.on('click', function (properties) {
        if (properties.nodes.length > 0) {
            const nodeId = properties.nodes[0];
            // Lógica para obter a URL do nó clicado e navegar
        }
    });

</script>

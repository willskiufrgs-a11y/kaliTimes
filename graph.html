---
layout: default
title: Mapa de Conceitos
permalink: /mapa/
---

<div id="mynetwork" style="width: 100%; height: 600px; border: 1px solid #ccc;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />

<script>

   
    // AQUI: No início do seu script

// PostURLs contém: ["/kalitimes/tccblog/", "/kalitimes/post-2/"]
    // 1. DADOS COLETADOS VIA LIQUID SERÃO INJETADOS AQUI (JSON)

// 1. INJEÇÃO DE DADOS: O Liquid insere o conteúdo HTML de TODOS os posts
    const allPosts = [
    {% for post in site.posts %}
        {
            url: "{{ post.url | relative_url }}",
            // IMPORTANTE: 'content' é o HTML completo do post.
            // O filtro 'escape_once' garante que aspas e caracteres especiais não quebrem o JSON.
            title: "{{ post.title | escape }}",
            content: `{{ post.content | strip_newlines }}`
        }
        {% unless forloop.last %},{% endunless %}
    {% endfor %}
    ];
    const postURLs = allPosts.map(p => p.url.toLowerCase()); 
    const nodes = [];
    const edges = [];
   //     {% for post in site.posts %}
    //    {
     //       id: "{{ post.url | relative_url }}",
   //         label: "{{ post.title | escape }}",
 //           url: "{{ post.url | relative_url }}",
 //           color: "#4da3ff" // Cor padrão para os nós
 //       }
//        {% unless forloop.last %},{% endunless %}
//    {% endfor %}
//    ];

    


// ... (Remova todo o loop allPosts.forEach anterior e use este)

const baseUrl = '{{ site.baseurl }}'; // Injeta o /kaliTimes
const postTitles = allPosts.map(p => p.title.toLowerCase());
const postIdss = [];
   allPosts.forEach(post => {
      let linkk = post.url;
      let stringg = linkk.split('/');
      postIdss.push(stringg.pop());
   });

   
allPosts.forEach(post => {
    // Adiciona o nó do post atual    post.url.split('/').pop()
    nodes.push({ id: post.url, label: post.title, url: post.url, color: "#4da3ff" });
    
    const parser = new DOMParser();
    const doc = parser.parseFromString(post.content, 'text/html');
    const links = doc.querySelectorAll('a');

    links.forEach(link => {
        let targetUrl = link.getAttribute('href');
        let linkStrings = targetUrl.split('/');
        let lastt = linkStrings.pop();
       if (postIdss.includes(lastt)) {
                          edges.push({
                    from: post.url,
                    to: '/kaliTimes/' + lastt + '/',
                    arrows: "to",
                    label: link.textContent.trim() 
                });
       }
            
            // 2. Normaliza para o formato esperado: /kaliTimes/titulo-do-post/
         //   targetUrl = targetUrl.toLowerCase();
            
            // 3. Encontra o post de destino na lista allPosts
        //    const foundPost = allPosts.find(p => p.url.toLowerCase().includes(targetUrl));

        //    if (foundPost && foundPost.url !== post.url) { 
                
                // Cria a aresta
        //        edges.push({
         //           from: post.url,
           //         to: targetUrl,
          //          arrows: "to",
          //          label: link.textContent.trim() 
          //      });
         //  }
        //}
    });
});
    

    // 2. INICIALIZAÇÃO DO VIS.JS
    const container = document.getElementById('mynetwork');
    const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
    const options = { 
        physics: { enabled: true }, 
        interaction: { navigationButtons: true } 
    };
    const network = new vis.Network(container, data, options);
    
    // Adiciona evento de click para navegação
    network.on('click', function (properties) {
        if (properties.nodes.length > 0) {
            const nodeId = properties.nodes[0];
            // Lógica para obter a URL do nó clicado e navegar
        }
    });

</script>
